module lib

rules
  map[ast -> instr]:: ast -> instr 
  map[x]([]) =
    continue()
    
  map[x]([h|t]) =
    x(h);
    map[x](t)

rules
  exit:: val -> return
  exit(code) =
    rcf <- getCF(curCF(), $ret);
    push(code, rcf);
    returnCF(rcf)
    
  resolveVar:: ast -> ast
  resolveVar(name) = resolve(name, "Var")